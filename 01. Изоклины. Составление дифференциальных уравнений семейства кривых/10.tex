\documentclass[a5paper,10pt]{article}

% https://github.com/InDevRus/filippov-solutions
\input{../preambles/general}
\input{../preambles/plotting}

\begin{document}

$y' = \dfrac {1} {y} - x$.

$f\br{x; y} = \dfrac {1} {y} - x$. Уравнение изоклины: $\dfrac {1} {y} - x = k$, $y = \dfrac {1} {x + k}$, $x = \dfrac {1} {y} - k$. Изоклинами будут гиперболы.

\begin{figure}[!h]
    \centering
    \begin{tikzpicture}
        \pgfplotsset{
            Graph/.style = {
                samples = 200,
                restrict y to domain = -5 : 5,
            },
            DirectionGraph/.style = {
                samples = 20,
                restrict y to domain = -5 : 5,
                quiver = {scale arrows = 0.075},
            },
            DirectionGraph1/.style = {
                DirectionGraph,
                quiver = {
                    u = {dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
            DirectionGraph2/.style = {
                DirectionGraph,
                quiver = {
                    u = {-dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {-dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
        }
        \begin{axis}[
            trig format plots=rad,
            width = 12cm,
            height = 10cm,
            ymin = -4.2,
            ymax = 4.2,
            xmin = -4.2,
            xmax = 4.2, 
            xtick = {-10, ..., 10},
            ytick = {-10, ..., 10},
            minor tick num = 3,
            declare function = {
                f(\k, \x) = 1 / (x + \k);
                dot_x(\x, \y) = y;
                dot_y(\x, \y) = 1 - x * y;
            }]

            \foreach \k in {-6, -5.5, ..., 6} {
                \addplot[Graph, gray, domain = -(\k) + 0.01 : 4.5]
                {f(\k, x)};
                \addplot[Graph, gray, domain = -4.5 : -(\k) - 0.01]
                {f(\k, x)};
                
                \addplot[DirectionGraph1, domain = -(\k) + 0.01 : -(\k) + 0.75]
                {f(\k, x)};
                \addplot[DirectionGraph1, domain = -(\k) - 0.75 : -(\k) - 0.01]
                {f(\k, x)};
                \addplot[DirectionGraph2, domain = -(\k) + 0.01 : -(\k) + 0.75]
                {f(\k, x)};
                \addplot[DirectionGraph2, domain = -(\k) - 0.75 : -(\k) - 0.01]
                {f(\k, x)};
                
                \addplot[DirectionGraph1, samples = 12, domain = -(\k) + 0.75 : -(\k) + 2]
                {f(\k, x)};
                \addplot[DirectionGraph1, samples = 12, domain = -(\k) - 2 : -(\k) - 0.75]
                {f(\k, x)};
                \addplot[DirectionGraph2, samples = 12, domain = -(\k) + 0.75 : -(\k) + 2]
                {f(\k, x)};
                \addplot[DirectionGraph2, samples = 12, domain = -(\k) - 2 : -(\k) - 0.75]
                {f(\k, x)};
            }
        \end{axis}
    \end{tikzpicture}
\end{figure}

\end{document}
