\documentclass[a5paper,10pt]{article}

% https://github.com/InDevRus/filippov-solutions

\input{../preambles/general}
\input{../preambles/plotting}

\begin{document}

Имеем уравнение $y' = \dfrac {4x} {x^2 + y^2}$. Для удобства дальнейших построений рассмотрим уравнение над обратной функцией $x\br{y}$, используя правило производной обратной функции: $x'\br{y} = \dfrac {x^2 + y^2} {4x}$.

При такой постановке задачи имеем уравнение изоклины: $\dfrac {x^2 + y^2} {4x} = m$, где $m = \dfrac {dx} {dy} \linebreak = \dfrac {1} {k} \ne 0$.
$x^2 - 4mx + y^2 = 0$, $\br{x^2 - 4mx + 4m^2} + y^2 = 4m^2$.
$\br{x - 2m}^2 + y^2 = \br{2m}^2$, так что изоклинами будут окружности с центром $\br{2m; 0}$ и радиусом $\vbr{2m} > 0$.
Формально говоря, на прямой $x = 0$, $y \ne 0$ касательная будет горизонтальной (для исходной задачи), а в точке $\br{0; 0}$ поведение производной неясно.
На левом рисунке изображены изоклины, на правом -- решения уравнений.

\begin{figure}[!h]
\begin{minipage}{.5\textwidth}
    \centering
    \begin{tikzpicture}
        \pgfplotsset{
            Graph/.style = {
                samples = 300,
                restrict y to domain = -5 : 5,
            },
            DirectionGraph/.style = {
                samples = 20,
                quiver = {scale arrows = 0.075},
                restrict y to domain = -5 : 5,
            },
            DirectionGraph1/.style = {
                DirectionGraph,
                quiver = {
                    u = {dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
            DirectionGraph2/.style = {
                DirectionGraph,
                quiver = {
                    u = {-dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {-dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
        }
        \begin{axis}[
            trig format plots = rad,
            width = 7.5cm,
            height = 10cm,
            ymin = -4.2,
            ymax = 4.2,
            xmin = -4.2,
            xmax = 4.2, 
            xtick = {-10, ..., 10},
            ytick = {-10, ..., 10},
            minor tick num = 3,
            declare function = {
                f(\m, \x) = 2 * \m + 2 * \m * cos(x);
                g(\m, \x) = 2 * \m * sin(x);
                dot_x(\x, \y) = x * x + y * y;
                dot_y(\x, \y) = 4 * x;
            }]

            \pgfplotsinvokeforeach {-4, -3.875, ..., -0.125, 0.125, 0.25, ..., 4} {
                \draw (2 * #1, 0) [gray, radius = 2 * abs(#1)] circle;
                    
                \addplot[DirectionGraph1, samples = 30 * abs(#1), domain = -pi * (1 - 0.15) : pi * (1 - 0.15)]
                ({f(#1, x)}, {g(#1, x)});
                \addplot[DirectionGraph2, samples = 30 * abs(#1), domain = -pi * (1 - 0.15) : pi * (1 - 0.15)]
                ({f(#1, x)}, {g(#1, x)});
            }
        \end{axis}
    \end{tikzpicture}
\end{minipage}
\begin{minipage}{.5\textwidth}
    \centering
    \begin{tikzpicture}
        \pgfplotsset{
            Graph/.style = {
                opacity = 0.25,
                samples = 500,
                restrict y to domain = -5 : 5,
            },
            PreciseGraph/.style = {
                Graph,
                thick,
                samples = 1500,
                opacity = 1,
            },
            DirectionGraph/.style = {
                opacity = 0.25,
                samples = 20,
                quiver = {scale arrows = 0.075},
                restrict y to domain = -5 : 5,
            },
            DirectionGraph1/.style = {
                DirectionGraph,
                quiver = {
                    u = {dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
            DirectionGraph2/.style = {
                DirectionGraph,
                quiver = {
                    u = {-dot_x(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)},
                    v = {-dot_y(x, y) / sqrt(dot_x(x, y) ^ 2 + dot_y(x, y) ^ 2)}
                }
            },
        }
        \begin{axis}[
            trig format plots = rad,
            width = 7.5cm,
            height = 10cm,
            ymin = -4.2,
            ymax = 4.2,
            xmin = -4.2,
            xmax = 4.2, 
            xtick = {-10, ..., 10},
            ytick = {-10, ..., 10},
            minor tick num = 3,
            declare function = {
                f(\m, \x) = 2 * \m + 2 * \m * cos(x);
                g(\m, \x) = 2 * \m * sin(x);
                dot_x(\x, \y) = x * x + y * y;
                dot_y(\x, \y) = 4 * x;
                h(\C, \x) = sqrt(\C * exp(x / 2) - ((x + 2)^2 + 4));
            }]

            \pgfplotsinvokeforeach {-4, -3.875, ..., -0.125, 0.125, 0.25, ..., 4} {
                \draw (2 * #1, 0) [gray, radius = 2 * abs(#1)] circle;
                    
                \addplot[DirectionGraph1, samples = 30 * abs(#1), domain = -pi * (1 - 0.15) : pi * (1 - 0.15)]
                ({f(#1, x)}, {g(#1, x)});
                \addplot[DirectionGraph2, samples = 30 * abs(#1), domain = -pi * (1 - 0.15) : pi * (1 - 0.15)]
                ({f(#1, x)}, {g(#1, x)});
            }

            \addplot[PreciseGraph, domain = 0 : 4.5]
            ({h(8, x)}, {x});
            \addplot[PreciseGraph, domain = 0 : 4.5]
            ({-h(8, x)}, {x});
            
            \addplot[PreciseGraph, olive, domain = -1 : 4.5]
            ({h(8.24216, x)}, {x});
            \addplot[PreciseGraph, olive, domain = -1 : 4.5]
            ({-h(8.24216, x)}, {x});
            
            \addplot[PreciseGraph, blue, domain = -1.5 : 4.5]
            ({h(8.99725, x)}, {x});
            \addplot[PreciseGraph, blue, domain = -1.5 : 4.5]
            ({-h(8.99725, x)}, {x});
            
            \addplot[PreciseGraph, red, domain = -2.2 : 4.5]
            ({h(10.8733, x)}, {x});
            \addplot[PreciseGraph, red, domain = -2.2 : 4.5]
            ({-h(10.8733, x)}, {x});

            \addplot[PreciseGraph, violet, domain = -2.5 : 4.5]
            ({h(14.834, x)}, {x});
            \addplot[PreciseGraph, violet, domain = -2.5 : 4.5]
            ({-h(14.834, x)}, {x});
            
            \addplot[PreciseGraph, brown, domain = -3 : 4.5]
            ({h(22.40845, x)}, {x});
            \addplot[PreciseGraph, brown, domain = -3 : 4.5]
            ({-h(22.40845, x)}, {x});
            
            \addplot[PreciseGraph, magenta, domain = -3.51 : 4.5]
            ({h(35.96625, x)}, {x});
            \addplot[PreciseGraph, magenta, domain = -3.51 : 4.5]
            ({-h(35.96625, x)}, {x});
            
            \addplot[PreciseGraph, teal, domain = -4.01 : 4.5]
            ({h(59.11244, x)}, {x});
            \addplot[PreciseGraph, teal, domain = -4.01 : 4.5]
            ({-h(59.11244, x)}, {x});

            \addplot[PreciseGraph, olive, domain = 0.5 - 0.01 : 4.5]
            ({h(7.982708, x)}, {x});
            \addplot[PreciseGraph, olive, domain = 0.5 - 0.01 : 4.5]
            ({-h(7.982708, x)}, {x});
            
            \addplot[PreciseGraph, blue, domain = 1 - 0.01 : 4.5]
            ({h(7.8849, x)}, {x});
            \addplot[PreciseGraph, blue, domain = 1 - 0.01 : 4.5]
            ({-h(7.8849, x)}, {x});

            \addplot[PreciseGraph, red, domain = 1.5 - 0.01 : 4.5]
            ({h(7.6759565, x)}, {x});
            \addplot[PreciseGraph, red, domain = 1.5 - 0.01 : 4.5]
            ({-h(7.6759565, x)}, {x});
            
            \addplot[PreciseGraph, violet, domain = 2 - 0.01 : 4.5]
            ({h(7.35758875, x)}, {x});
            \addplot[PreciseGraph, violet, domain = 2 - 0.01 : 4.5]
            ({-h(7.35758875, x)}, {x});
            
            \addplot[PreciseGraph, brown, domain = 2.5 - 0.01 : 4.5]
            ({h(6.9477413, x)}, {x});
            \addplot[PreciseGraph, brown, domain = 2.5 - 0.01 : 4.5]
            ({-h(6.9477413, x)}, {x});
            
            \addplot[PreciseGraph, magenta, domain = 3 - 0.01 : 4.5]
            ({h(6.4707746, x)}, {x});
            \addplot[PreciseGraph, magenta, domain = 3 - 0.01 : 4.5]
            ({-h(6.4707746, x)}, {x});
            
            \addplot[PreciseGraph, teal, domain = 3.5 - 0.01 : 4.5]
            ({h(5.9517575, x)}, {x});
            \addplot[PreciseGraph, teal, domain = 3.5 - 0.01 : 4.5]
            ({-h(5.9517575, x)}, {x});
        \end{axis}
    \end{tikzpicture}
\end{minipage}
\end{figure}

\begin{remark} Кривые на рисунке справа построены \vspace{1mm} по общему решению исходного уравнения, которое имеет неявную форму $x^2 + \br{y + 2}^2 = C\tpow{e}{\elevate{\frac {y}{2}}} - 4$.
\end{remark} 

\end{document}
